---
title: "HIGGS"
output: html_document
---

## Load libraries

  glmnet used for feature selection.
  modelr used for data splitting.
  tidymodels used for roc curve.
  tidyverse used for tibble.

```{r}
library(glmnet)
library(modelr)
library(tidymodels)
library(tidyverse)
library(MASS)

set.seed(0)
```

## Parse dataset

  Data is stored in csv file.
  
  Loads all rows of csv file,
  without X column (which just stores row index)

```{r}
higgs <- read.csv("../data/higgs.csv") %>% subset(select = -X)
head(higgs)
```

## Split into train/test sets

  Train set is 70% of data.
  Test set is 30% of data.

```{r}
rp <- resample_partition(higgs, c(train = 0.7, test = 0.3))

train <- as_tibble(rp$train)
test <- as_tibble(rp$test)
```

## Feature selection

  All but "jet.3.eta" and "jet.4.eta" are important variables.

```{r}
x <- model.matrix(signal ~ ., data = train)
y <- train$signal
en_fit <- cv.glmnet(x, y, alpha = 0.5)

coef(en_fit, s = "lambda.min")
```

## Preliminary model fitting

### Logistic Regression

```{r}
glm_fit <- glm(signal ~ . - jet.3.eta - jet.4.eta, data = train, family = binomial)
train_glm <- train %>% 
    add_predictions(glm_fit) %>% 
    mutate(prob = exp(pred)/ (1 + exp(pred)), pred.signal = ifelse(prob > 0.5, 1, 0))
train_glm %>% count(signal, pred.signal) %>% spread(signal, n)
autoplot(roc_curve(train_glm, as.factor(signal), prob))
```


### GAM 

```{r} 
library(gam)
gam_fit <- gam(signal ~ s(lepton.pT) + s(lepton.eta) + s(lepton.phi)+ s(missing.energy.magnitude)+ s(missing.energy.phi)+ s(jet.1.pt)+ s(jet.1.eta)+ s(jet.1.phi) + s(jet.2.pt)+ s(jet.2.eta)+ s(jet.2.phi)+s(jet.3.pt)+ s(jet.3.eta)+ s(jet.3.phi)+s(jet.4.pt)+ s(jet.4.eta)+ s(m_jj)+s(m_jjj)+ s(m_lv)+ s(m_jlv)+ s(m_bb)+ s(m_wbb) + s(m_wwbb), data = train)

summary(gam_fit)
predict(gam_fit, test)
plot(gam_fit, se = TRUE)

```

### LDA

```{r}

lda_fit <- lda(signal ~ . - jet.3.eta - jet.4.eta, data = train)

test$signal 
pred <- predict(lda_fit, test)$class
mean((as.numeric(test$signal) - as.numeric(pred))^2)

```






